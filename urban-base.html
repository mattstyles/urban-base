<link rel="import" href="../polymer/polymer.html">

<polymer-element name="urban-base">

    <script charset="utf-8">

            (function( root ) {

                /**
                 * Simplest extend function
                 */
                function extend( base, obj ) {
                    for ( var prop in obj ) {
                        if ( !base.hasOwnProperty( prop ) ) {
                            base[ prop ] = obj[ prop ];
                        }
                    }

                    return base;
                }


                Polymer( 'urban-base', {

                    /**
                     * List of attached listeners
                     */
                    _listeners: null,


                    /*-----------------------------------------------------------*\
                     *
                     *  Polymer lifecycle events
                     *
                    \*-----------------------------------------------------------*/

                    created: function() {
                        this._listeners = [];
                    },


                    ready: function() {
                        this.bindAll( this );
                    },



                    /*-----------------------------------------------------------*\
                     *
                     *  Helpers
                     *
                    \*-----------------------------------------------------------*/


                    /**
                     * Simple, dirty bindAll implementation
                     *
                     * @param ctx {Object} the context to bind `this` to
                     */
                    bindAll: function( ctx ) {
                        for ( var method in this ) {
                            if ( typeof this[ method ] === 'function' && !this.hasOwnProperty( method ) ) {
                                try {
                                    this[ method ] = this[ method ].bind( ctx );
                                } catch( err ) {
                                    console.log( this.element.name + '::', 'method binding error\n', method, err );
                                }
                            }
                        }
                    },


                    /**
                     * Adds an event listener that will be removed after the first execution
                     *
                     * @param type {String} id of event to listen for
                     * @param data {Anything} _optional_ additional data that is always passed to the callback - takes precedence over data passed along with the firing/triggering of the event
                     * @param cb {Function} the callback to fire when the event is fired
                     * @param ctx {Object} _optional_ the context the callback should be run in, defaults to __this__
                     */
                    once: function( type, data, cb, ctx ) {
                        // Arity
                        if ( typeof data === 'function' ) {
                            this.once( type, null, data, cb );
                            return;
                        }

                        var callback = function( event ) {
                            this.removeEventListener( type, callback );

                            // Append emitter data to event.detail
                            if ( typeof data === 'object' ) {
                                event.detail = extend( event.detail, data );
                            } else {
                                event.detail.data = data;
                            }

                            cb.call( ctx || this, event );
                        }.bind( this );

                        this.addEventListener( type, callback );
                    },


                    /**
                     * Semi-alias for addEventListener.
                     * Wraps context to the listening object.
                     *
                     */
                    on: function( type, data, cb, ctx ) {

                    }
                });


            })( this );

    </script>
</polymer-element>
