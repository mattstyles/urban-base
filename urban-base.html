<link rel="import" href="../polymer/polymer.html">

<polymer-element name="urban-base">

    <script charset="utf-8">

            (function( root ) {

                Polymer( 'urban-base', {

                    /**
                     * List of attached listeners
                     */
                    _listeners: null,


                    /*-----------------------------------------------------------*\
                     *
                     *  Polymer lifecycle events
                     *
                    \*-----------------------------------------------------------*/

                    created: function() {
                        this._listeners = [];
                    },


                    ready: function() {
                        this.bindAll( this );
                    },



                    /*-----------------------------------------------------------*\
                     *
                     *  Helpers
                     *
                    \*-----------------------------------------------------------*/


                    /**
                     * Simple, dirty bindAll implementation
                     *
                     * @param ctx {Object} the context to bind `this` to
                     */
                    bindAll: function( ctx ) {
                        for ( method in this ) {
                            if ( typeof this[ method ] === 'function' && !this.hasOwnProperty( method ) ) {
                                try {
                                    this[ method ] = this[ method ].bind( ctx );
                                } catch( err ) {
                                    console.log( this.element.name + '::', 'method binding error\n', method, err );
                                }
                            }
                        }
                    },


                    /**
                     * Adds an event listener that will be removed after the first execution
                     *
                     * @param type {String} id of event to listen for
                     * @param cb {Function} the callback to fire when the event is fired
                     * @param ctx {Object} the context the callback should be run in, defaults to __this__
                     */
                    once: function( type, data, cb, ctx ) {
                        // If data was not supplied then it'll be the handler
                        if ( typeof data === 'function' ) {
                            this.once( type, null, data, cb );
                            return;
                        }

                        var callback = function( event ) {
                            this.removeEventListener( type, callback );
                            cb.call( ctx || this, event, data );
                        }.bind( this );

                        this.addEventListener( type, callback );
                    }
                });


            })( this );

    </script>
</polymer-element>
